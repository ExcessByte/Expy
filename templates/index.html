<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Expense Tracker</title>
  <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Expy.</h1>
      <div style="display: flex; gap: 10px;">
        <button class="add-button" id="openFilterBtn">Filter</button>
        <button class="add-button" id="openModalBtn">Add Transaction</button>
      </div>
    </div>

    <div class="summary">
      <div class="summary-item">
        <h3>Income</h3>
        <p class="summary-income">{{ summary.income }}</p>
      </div>
      <div class="summary-item">
        <h3>Expenses</h3>
        <p class="summary-expense">{{ summary.expenses }}</p>
      </div>
      <div class="summary-item">
        <h3>Net Balance</h3>
        <p class="summary-balance">{{ summary.balance }}</p>
      </div>
    </div>

    <h2>Transactions</h2>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Category</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for t in transactions %}
        <tr>
          <td>{{ t.formatted_date }}</td>
          <td>{{ t.description }}</td>
          <td>{{ t.category }}</td>
          <td>{{ t.type }}</td>
          <td class="{{ 'income-amount' if t.type=='income' else 'expense-amount' }}">
            {{ t.formatted_amount }}
          </td>
          <td>
            <a href="#" class="edit-button"
               data-id="{{ t.id }}"
               data-date="{{ t.date }}"
               data-description="{{ t.description }}"
               data-category="{{ t.category }}"
               data-type="{{ t.type }}"
               data-amount="{{ t.amount }}">Edit</a>
            <a href="/delete/{{ t.id }}" class="delete-button">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Transaction Modal (Add/Edit) -->
  <div id="transactionModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2 id="modalTitle">Add a New Transaction</h2>
      <form id="transactionForm" method="POST" action="/add">
        <input type="hidden" id="transactionId">
        <div class="form-group">
          <label>Date:</label>
          <input type="date" name="date" id="dateField">
        </div>
        <div class="form-group">
          <label>Description:</label>
          <input type="text" name="description" id="descField" required>
        </div>
        <div class="form-group">
          <label>Category:</label>
          <select name="category" id="catField">
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Utilities">Utilities</option>
            <option value="Work">Work</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Type:</label>
          <select name="type" id="typeField">
            <option value="expense">Expense</option>
            <option value="income">Income</option>
          </select>
        </div>
        <div class="form-group">
          <label>Amount:</label>
          <input type="number" step="0.01" name="amount" id="amountField" required>
        </div>
        <button type="submit" id="submitBtn">Save</button>
      </form>
    </div>
  </div>

  <!-- Filter Modal (unchanged) -->
  <div id="filterModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Filter Transactions</h2>
      <form method="GET" action="/">
        <div class="form-group">
          <label>Category:</label>
          <select name="category">
            <option value="all" {% if selected_category=="all" %}selected{% endif %}>All</option>
            <option value="Food" {% if selected_category=="Food" %}selected{% endif %}>Food</option>
            <option value="Transport" {% if selected_category=="Transport" %}selected{% endif %}>Transport</option>
            <option value="Utilities" {% if selected_category=="Utilities" %}selected{% endif %}>Utilities</option>
            <option value="Work" {% if selected_category=="Work" %}selected{% endif %}>Work</option>
            <option value="Other" {% if selected_category=="Other" %}selected{% endif %}>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Type:</label>
          <select name="type">
            <option value="all" {% if selected_type=="all" %}selected{% endif %}>All</option>
            <option value="income" {% if selected_type=="income" %}selected{% endif %}>Income</option>
            <option value="expense" {% if selected_type=="expense" %}selected{% endif %}>Expense</option>
          </select>
        </div>
        <div class="form-group">
          <label>Year:</label>
          <select name="year">
            <option value="all" {% if selected_year=="all" %}selected{% endif %}>All</option>
            {% for year in range(2020, 2030) %}
              <option value="{{year}}" {% if selected_year==year|string %}selected{% endif %}>{{year}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label>Month:</label>
          <select name="month">
            <option value="all" {% if selected_month=="all" %}selected{% endif %}>All</option>
            {% for month_name in months %}
              <option value="{{ loop.index }}" {% if selected_month==loop.index|string %}selected{% endif %}>{{ month_name }}</option>
            {% endfor %}
          </select>
        </div>
        <button type="submit">Apply Filters</button>
      </form>
    </div>
  </div>
  <script>
    var addModal = document.getElementById("transactionModal");
    var filterModal = document.getElementById("filterModal");
    var openAddBtn = document.getElementById("openModalBtn");
    var openFilterBtn = document.getElementById("openFilterBtn");
    var closeButtons = document.getElementsByClassName("close-button");
  
    var form = document.getElementById("transactionForm");
    var modalTitle = document.getElementById("modalTitle");
    var submitBtn = document.getElementById("submitBtn");

    openAddBtn.onclick = function() {
      form.action = "/add";
      modalTitle.innerHTML = "Add a New Transaction";
      submitBtn.innerHTML = "Save";
      form.date.value = "";
      form.description.value = "";
      form.category.value = "Food";
      form.type.value = "expense";
      form.amount.value = "";
      addModal.style.display = "block";
    };

    openFilterBtn.onclick = function() {
      filterModal.style.display = "block";
    };
  
    document.onclick = function(event) {
      if (event.target.className === "edit-button") {
        event.preventDefault();
        form.action = "/edit/" + event.target.getAttribute("data-id");
        modalTitle.innerHTML = "Edit Transaction";
        submitBtn.innerHTML = "Update";
  
        document.getElementById("dateField").value = event.target.getAttribute("data-date");
        document.getElementById("descField").value = event.target.getAttribute("data-description");
        document.getElementById("catField").value = event.target.getAttribute("data-category");
        document.getElementById("typeField").value = event.target.getAttribute("data-type");
        document.getElementById("amountField").value = event.target.getAttribute("data-amount");
  
        addModal.style.display = "block";
      }
    };

    for (var i = 0; i < closeButtons.length; i++) {
      closeButtons[i].onclick = function() {
        addModal.style.display = "none";
        filterModal.style.display = "none";
      }
    }
  
    window.onclick = function(event) {
      if (event.target == addModal) {
        addModal.style.display = "none";
      }
      if (event.target == filterModal) {
        filterModal.style.display = "none";
      }
    };
  </script>  
</body>
</html>
